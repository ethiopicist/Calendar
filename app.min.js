///////////////////////
// Calendar Builder //
/////////////////////
function buildCalendar(){
// calendar header
// since text() will remove child elements, save them as a var
var e=$(".calendar-title").children();for($(".calendar-title").text(printTitle()),$(".calendar-title").append(e),j=0;j<7;j++)$(".calendar-dow").append($("<th/>").text(printDayName(j)));
// calendar cells
for(var t=firstOfCalendar(),a=1;t<=lastOfMonth();){for($("tbody").append('<tr id="calendar-row-'+a+'"></tr>'),j=0;j<7;j++){var r=$("<td/>");getPref("showgDates")&&r.append($('<span class="gdate"/>').text(t.getDate())),r.append($('<span class="edate"/>').text(printDayInt(eDate(t).day))),
// highlight today
t.toLocaleDateString()==(new Date).toLocaleDateString()&&r.addClass("today"),
// if date belongs to prev/next month
eDate(t).month!=theDate("em")&&(r.addClass("outside"),1==a&&0==j?r.append($('<span class="emonth"/>').text(printMonthName(eDate(t).month))):eDate(dayBefore(t)).month==theDate("em")&&r.append($('<span class="emonth"/>').text(printMonthName(eDate(t).month)))),
// if date belongs to prev/next gregorian month
(dayBefore(t).getMonth()!==t.getMonth()||1==a&&0==j)&&getPref("showgDates")&&r.append($('<span class="gmonth"/>').text(t.toLocaleString("en-us",{month:getPref("longNames")?"long":"short"}))),$("#calendar-row-"+a).append(r),t.setDate(t.getDate()+1)}a++}
// filler rows, mainly for Pagumen
for(;a<=5;)$("tbody").append('<tr id="calendar-row-'+a+'"><td colspan="7"/></tr>'),a++}function rebuildCalendar(){
// reset calendar header
var e=$(".calendar-title").children();$(".calendar-title").text(""),$(".calendar-title").append(e),$(".calendar-dow").html(""),
// reset calendar
$("tbody").html(""),
//build calendar again
buildCalendar()}
////////////////////////////
// Application Functions //
//////////////////////////
function getPref(e){
// the default prefs
var t={ethletters:!0,ethnumbers:!0,monthNames:"gez",dowNames:"gez",longNames:!0,showgDates:!0};
// if prefs have not been set, set them to the defaults
null===localStorage.getItem("preferences")&&localStorage.setItem("preferences",JSON.stringify(t));
// retrieve and parse prefs
var a=JSON.parse(localStorage.getItem("preferences"));
// check if pref is valid
return"object"!=typeof a&&localStorage.setItem("preferences",JSON.stringify(t)),!!t.hasOwnProperty(e)&&(a.hasOwnProperty(e)||(a[e]=t[e],localStorage.setItem("preferences",JSON.stringify(a))),a[e])}function setPref(e,t){
// validate val
var a={ethletters:"boolean",ethnumbers:"boolean",monthNames:["gez","amh","tig"],dowNames:["gez","amh","tig","eng"],longNames:"boolean",showgDates:"boolean"};if(!a.hasOwnProperty(e))return!1;// not a valid pref
// not a valid value for val
// get old prefs
if("object"==typeof a[e]){if(!a[e].includes(t))return!1;// not a valid value for val
}else if(typeof t!==a[e])return!1;var r=JSON.parse(localStorage.getItem("preferences"));
// update prefs
r[e]=t,localStorage.setItem("preferences",JSON.stringify(r)),rebuildCalendar()}function theDate(e){
// retrieve currentDate from local storage
var t=JSON.parse(localStorage.getItem("currentDate"));if(null!==t&&"object"==typeof t&&t.hasOwnProperty("year")&&t.hasOwnProperty("month")&&t.hasOwnProperty("day"))return"ey"==e?t.year:"em"==e?t.month:"ed"==e?t.day:("gy"==e||"gm"==e||"gd"==e)&&(t=ethiopicToGregorian(t.year,t.month,t.day),"gy"==e?t.year:"gm"==e?t.month:"gd"==e?t.day:void 0);var a=new Date;return a=gregorianToEthiopic(a.getFullYear(),a.getMonth()+1,a.getDate()),localStorage.setItem("currentDate",JSON.stringify({year:a.year,month:a.month,day:a.day})),theDate(e)}function setTheDate(e,t,a){localStorage.setItem("currentDate",JSON.stringify({year:e,month:t,day:a})),rebuildCalendar()}
////////////////////////////////////
// Calendar Calcuation Functions //
//////////////////////////////////
// return a Date object for the first day of the Ethiopian month
function firstOfMonth(){var e=ethiopicToGregorian(theDate("ey"),theDate("em"),1);return new Date(e.year,e.month-1,e.day)}
// return a Date object for the first day displayed on the calendar
function firstOfCalendar(){var e=firstOfMonth(),t=firstOfMonth().getDay()-1;return 0==firstOfMonth().getDay()&&(t=6),e.setDate(e.getDate()-t),e}
// return a Date object for the last day of the Ethiopian month
function lastOfMonth(){if(13==theDate("em"))if(theDate("ey")%4==3)var e=ethiopicToGregorian(theDate("ey"),theDate("em"),6);else var e=ethiopicToGregorian(theDate("ey"),theDate("em"),5);else var e=ethiopicToGregorian(theDate("ey"),theDate("em"),30);return new Date(e.year,e.month-1,e.day)}function dayBefore(e){var t=new Date(e);return t.setDate(t.getDate()-1),t}function dayAfter(e){var t=new Date(e);return t.setDate(t.getDate()+1),t}
// given a Date object, return the Ethiopian date
function eDate(e){return gregorianToEthiopic(e.getFullYear(),e.getMonth()+1,e.getDate())}
//////////////////////////////
// Text Printing Functions //
////////////////////////////
function printMonthName(e){var t=["መስከረም","ጥቅምት","ኅዳር","ታኅሣሥ","ጥር","የካቲት","መጋቢት","ሚያዝያ","ግንቦት","ሰኔ","ሐምሌ","ነሐሴ","ጳጕሜን"],a=["Maskaram","Ṭəqəmt","Ḫədār","Tāḫśāś","Ṭərr","Yakkātit","Maggābit","Miyāzyā","Gənbot","Sane","Ḥamle","Naḥase","Ṗāgʷəmen"],r=t.slice();r[5]="ለካቲት",r[4]="ጥሪ";var n=a.slice();n[5]="Lakkātit",n[4]="Ṭərri";var o="";return o="tig"==getPref("monthNames")&&getPref("ethletters")?r[e-1]:"tig"==getPref("monthNames")?n[e-1]:getPref("ethletters")?t[e-1]:a[e-1],getPref("longNames")?o:o.substr(0,3)}function printDayName(e){var t=["ሰኑይ","ሠሉስ","ረቡዕ","ኀሙስ","ዐርብ","ቀዳም","እሑድ"],a=["Sanuy","Śalus","Rabuʿ","Ḫamus","ʿArb","Qadām","ʾƎḥud"],r=["ሰኞ","መክሰኞ","ረቡዕ","ኀሙስ","ዓርብ","ቅዳሜ","እሑድ"],n=["Saño","Maksaño","Rabuʿ","Ḫamus","ʿĀrb","Qədāme","ʾƎḥud"],o=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],i="";return i="eng"==getPref("dowNames")?o[e]:"eng"==getPref("dowNames")?o[e]:"amh"==getPref("dowNames")&&getPref("ethletters")?r[e]:"amh"==getPref("dowNames")?n[e]:getPref("ethletters")?t[e]:a[e],getPref("longNames")?i:4!=e||"amh"!=getPref("dowNames")||getPref("ethletters")?6!=e||"amh"!=getPref("dowNames")||getPref("ethletters")?i.substr(0,3):"ʾ"+i.substr(1,3):"ʿ"+i.substr(1,3)}function printDayInt(e){return getPref("ethnumbers")?ethiopicNumber(e):e}function printTitle(){var e=printMonthName(theDate("em"))+" ";return getPref("ethnumbers")?e+=ethiopicNumber(theDate("ey")):e+=theDate("ey"),e}function ethiopicNumber(e){return"number"!=typeof e&&(e=parseInt(e)),0==e?"":1==e?"፩":2==e?"፪":3==e?"፫":4==e?"፬":5==e?"፭":6==e?"፮":7==e?"፯":8==e?"፰":9==e?"፱":10<=e&&e<20?"፲"+ethiopicNumber(e-10):20<=e&&e<30?"፳"+ethiopicNumber(e-20):30<=e&&e<40?"፴"+ethiopicNumber(e-30):40<=e&&e<50?"፵"+ethiopicNumber(e-40):50<=e&&e<60?"፶"+ethiopicNumber(e-50):60<=e&&e<70?"፷"+ethiopicNumber(e-60):70<=e&&e<80?"፸"+ethiopicNumber(e-70):80<=e&&e<90?"፹"+ethiopicNumber(e-80):90<=e&&e<100?"፺"+ethiopicNumber(e-90):100<=e&&e<200?"፻"+ethiopicNumber(e-100):200<=e&&e<1e4?ethiopicNumber((e-e%100)/100)+"፻"+ethiopicNumber(e%100):1e4<=e&&e<2e4?"፼"+ethiopicNumber(e-1e4):2e4<=e&&e<1e6?ethiopicNumber((e-e%1e4)/1e4)+"፼"+ethiopicNumber(e%1e4):void 0}$(document).ready(function(){buildCalendar(),
// calendar onclick events
$(document).on("click","a#today",function(){var e=new Date;setTheDate(eDate(e).year,eDate(e).month,eDate(e).day)}),$(document).on("click","a#prev-month",function(){var e=firstOfMonth();e.setDate(e.getDate()-1),setTheDate(eDate(e).year,eDate(e).month,eDate(e).day)}),$(document).on("click","a#next-month",function(){var e=lastOfMonth();e.setDate(e.getDate()+1),setTheDate(eDate(e).year,eDate(e).month,eDate(e).day)});
// set up prefs
var e=JSON.parse(localStorage.getItem("preferences"));for(var t in e)e.hasOwnProperty(t)&&("boolean"==typeof e[t]?e[t]?$("#"+t).attr("checked",!0):$("#"+t).attr("checked",!1):$("#"+t).val(e[t]));
// prefs onclick and onchange events
$(document).on("click","a#open-preferences",function(){$("#preferences-overlay").show()}),$(document).on("click","a#close-preferences",function(){$("#preferences-overlay").hide()}),$(document).on("change","select",function(){setPref($(this).attr("id"),$(this).val())}),$(document).on("change","input[type=checkbox]",function(){setPref($(this).attr("id"),$(this).is(":checked"))})});