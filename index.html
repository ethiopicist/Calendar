<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="An online Ethio-Eritrean calendar in Amharic, Tigrinya, and English.">
  <meta name="keywords" content="ethiopian calendar, ethiopian, calendar, eritrean">
  <title>Ethiopian-Eritrean Calendar</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="style.css">
  <script src="jquery.min.js"></script>

  <script src="i18n/jquery.i18n.js"></script>
  <script src="i18n/CLDRPluralRuleParser.js"></script>
  <script src="i18n/jquery.i18n.messagestore.js"></script>
  <script src="i18n/jquery.i18n.fallbacks.js"></script>
  <script src="i18n/jquery.i18n.language.js"></script>
  <script src="i18n/jquery.i18n.parser.js"></script>
  <script src="i18n/jquery.i18n.emitter.js"></script>
  <script src="i18n/jquery.i18n.emitter.bidi.js"></script>

  <script src="ethiopiancalendar.min.js"></script>
</head>
<body>
  <section class="section">
    <div id="container" class="container">
      <div id="calendar" class="calendar tile is-ancestor is-vertical"></div>
    </div>
  </section>

  <div id="calendar-controls" class="tile is-parent is-2">
    <div class="tile is-child">
      <div class="buttons has-addons" style="margin-bottom: 0px">
        <a id="prev-month" class="button is-small is-dark is-outlined" style="margin-bottom: 0px" data-i18n-label="ariaPrev">
          <span class="octicon octicon-chevron-left" style="margin-left: 6.5px; font-size: 1rem;"></span>
        </a>
        <a id="today-month" class="button is-small is-dark is-outlined" style="margin-bottom: 0px" data-i18n="today" data-i18n-label="ariaToday">Today</a>
        <!--<a id="go-to-month" class="button is-small is-dark is-outlined is-hidden-touch" style="margin-bottom: 0px" data-i18n="goto" data-i18n-label="goto">Go To&hellip;</a>-->
        <a id="next-month" class="button is-small is-dark is-outlined" style="margin-bottom: 0px" data-i18n-label="ariaNext">
          <span class="octicon octicon-chevron-right" style="margin-left: 6.5px; font-size: 1rem;"></span>
        </a>
      </div>
    </div>
  </div>

  <div id="calendar-preferences" class="tile is-parent is-2">
    <div class="tile is-child">
      <div class="buttons has-addons is-right" style="margin-bottom: 0px">
        <a id="open-languages" class="button is-small is-dark is-outlined" style="margin-bottom: 0px" data-i18n-label="ariaOpenLanguages">
          <span class="octicon octicon-globe" style="font-size: 1rem;"></span>
        </a>
        <a id="open-prefs" class="button is-small is-dark is-outlined" style="margin-bottom: 0px" data-i18n-label="ariaOpenPreferences">
          <span class="octicon octicon-gear" style="font-size: 1rem;"></span>
        </a>
        <a class="button is-small is-dark is-outlined" style="margin-bottom: 0px" data-i18n-label="ariaHelp">
          <span class="octicon octicon-question" style="font-size: 1rem;"></span>
        </a>
      </div>
    </div>
  </div>

  <nav id="calendar-controls-mobile" class="navbar is-light is-fixed-bottom is-hidden-tablet">
    <div class="navbar-start">
      <a id="prev-month-mobile" class="navbar-item" data-i18n-label="ariaPrev">
        <span class="octicon octicon-chevron-left" style="margin-left: 10px; font-size: 1.5em"></span>
      </a>
      <a id="today-month-mobile" class="navbar-item" data-i18n="today">Today</a>
      <a id="next-month-mobile" class="navbar-item" data-i18n-label="ariaNext">
        <span class="octicon octicon-chevron-right" style="margin-left: 10px; font-size: 1.5em"></span>
      </a>
    </div>
    <div class="navbar-end">
      <a id="open-languages" class="navbar-item" data-i18n-label="ariaOpenLanguages">
        <span class="octicon octicon-globe" style="margin-left: 6.5px; font-size: 1.5em"></span>
      </a>
      <a id="open-prefs" class="navbar-item" data-i18n-label="ariaOpenPreferences">
        <span class="octicon octicon-gear" style="margin-left: 6.5px; font-size: 1.5em"></span>
      </a>
      <a class="navbar-item" data-i18n-label="ariaHelp">
        <span class="octicon octicon-question" style="margin-left: 6.5px; font-size: 1.5em"></span>
      </a>
    </div>
  </nav>

  <div id="language-picker" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title" data-i18n="appLanguage">Change Application Language:</p>
        <button class="delete" data-i18n-label="ariaClose"></button>
      </header>
      <section class="modal-card-body">
        <nav class="panel">
          <a class="panel-block" data-value="en">English</a>
          <!--<a class="panel-block" data-value="am">አማርኛ</a>
          <a class="panel-block" data-value="ti">ትግርኛ</a>
          <a class="panel-block" data-value="om">Oromoo</a>-->
          <a class="panel-block" data-value="pl">Polski</a>
          <!--<a class="panel-block" data-value="fr">Français</a>-->
        </nav>
      </section>
      <footer class="modal-card-foot has-text-right"><small data-i18n="changesSaved">Changes are saved automatically.</small></footer>
    </div>
  </div>

  <div id="prefs-window" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title" data-i18n="preferences">Preferences</p>
        <button class="delete" data-i18n-label="ariaClose"></button>
      </header>
      <section class="modal-card-body">
        <aside class="menu">

          <p class="menu-label" data-i18n="calendarPreferences">Calendar Preferences</p>
          <ul class="menu-list">
            <li>
              <a data-i18n="weekBegins">Week begins on:</a>
              <ul id="startDay">
                <li><a data-i18n="day0long" data-value="0">Sunday</a></li>
                <li><a data-i18n="day1long" data-value="1">Monday</a></li>
              </ul>
            </li>
            <li><a class="toggle-control" data-i18n="gregorianDates" id="gregorianDates">Show Gregorian dates</a></li>
          </ul>

          <p class="menu-label" data-i18n="languagePreferences">Language Preferences</p>
          <ul class="menu-list">
            <li>
              <a data-i18n="calendarLanguage">Calendar language:</a>
              <ul id="calendarLanguage">
                <li><a data-i18n="geez" data-value="gez">Gəʿəz</a></li>
                <li><a data-i18n="amharic" data-value="amh">Amharic</a></li>
                <li><a data-i18n="tigrinya" data-value="tig">Tigrinya</a></li>
                <li><a data-i18n="oromoo" data-value="oro">Oromoo</a></li>
              </ul>
            </li>
            <li><a class="toggle-control" data-i18n="showLocale" id="localeDays">Show days of the week in English</a></li>
          </ul>

          <p class="menu-label" data-i18n="displayPreferences">Display Preferences</p>
          <ul class="menu-list">
            <li><a class="toggle-control" data-i18n="useLetters" id="useLetters">Use Ethiopic letters</a></li>
            <li><a class="toggle-control" data-i18n="useNumbers" id="useNumbers">Use Ethiopic numbers</a></li>
          </ul>

        </aside>
      </section>
      <footer class="modal-card-foot"><small data-i18n="changesSaved">Changes are saved automatically.</small></footer>
    </div>
  </div>

  <script>
    $(document).ready(function(){

      // Calendar initializing

      $('#calendar').ethiopianCalendar({
        'useSavedPrefs': true,
        'savePrefs': true
      }, postProcess);

      // Calendar updating

      $(document).on('click', 'a[id^="today-month"]', function(){
        preProcess();

        $('#calendar').ethiopianCalendar('update', {
          'savePrefs': true,
          'useSavedPrefs': true,
          'calendarMonth': (new Date())
        }, postProcess);
      });

      $(document).on('click', 'a[id^="prev-month"]', function(){
        preProcess();

        var prefs = JSON.parse(localStorage.getItem('calendar-prefs'));
        prevMonth = new Date(prefs['calendarMonth']);

        prevMonth.setDate(prevMonth.getDate() - prevMonth.toLocaleDateString('en-US-u-ca-ethiopic', {day: 'numeric'}));
        
        $('#calendar').ethiopianCalendar('update', {
          'savePrefs': true,
          'useSavedPrefs': true,
          'calendarMonth': prevMonth
        }, postProcess);
      });

      $(document).on('click', 'a[id^="next-month"]', function(){
        preProcess();

        var prefs = JSON.parse(localStorage.getItem('calendar-prefs'));
        var nextMonth = new Date(prefs['calendarMonth']);

        var m = 30;
        if(nextMonth.toLocaleDateString('en-US-u-ca-ethiopic', {month: 'numeric'}) == 13){
          if(parseInt(nextMonth.toLocaleDateString('en-US-u-ca-ethiopic', {year: 'numeric'}).substr(0, 4)) % 4 == 3) m = 6;
          else m = 5;
        }
        m = m + 1 - nextMonth.toLocaleDateString('en-US-u-ca-ethiopic', {day: 'numeric'});
  
        nextMonth.setDate(nextMonth.getDate() + m);
        
        $('#calendar').ethiopianCalendar('update', {
          'savePrefs': true,
          'useSavedPrefs': true,
          'calendarMonth': nextMonth
        }, postProcess);
      });

      // Language picker

      $('#language-picker .panel-block').append(
        $('<span class="octicon octicon-check is-pulled-right" />')
      );

      // Show/hide

      $(document).on('click', 'a[id^="open-languages"]', function(){
        $('div#language-picker').addClass('is-active');
        $('html').addClass('is-clipped');
      });

      $(document).on('click', 'div#language-picker div.modal-background, div#language-picker button', function(){
        $('div#language-picker').removeClass('is-active');
        $('html').removeClass('is-clipped');
      });

      // Change

      $(document).on('click', 'div#language-picker a.panel-block', function(){
        preProcess();

        $('div#language-picker').removeClass('is-active');
        $('html').removeClass('is-clipped');

        var locale = $(this).data('value');
        
        $('#calendar').ethiopianCalendar('update', {
          'savePrefs': true,
          'useSavedPrefs': true,
          'locale': locale
        }, postProcess);
      });

      // Prefs window

      // Show/hide

      $(document).on('click', 'a[id^="open-prefs"]', function(){
        $('div#prefs-window').addClass('is-active');
        $('html').addClass('is-clipped');
      });

      $(document).on('click', 'div#prefs-window div.modal-background, div#prefs-window button', function(){
        $('div#prefs-window').removeClass('is-active');
        $('html').removeClass('is-clipped');
      });

      // Change
      $(document).on('click', 'div#prefs-window ul#startDay a', function(){
        preProcess();

        var value = $(this).data('value');
        
        $('#calendar').ethiopianCalendar('update', {
          'savePrefs': true,
          'useSavedPrefs': true,
          'startDay': value
        }, postProcess);
      });

      $(document).on('click', 'div#prefs-window ul#calendarLanguage a', function(){
        preProcess();

        var value = $(this).data('value');
        
        $('#calendar').ethiopianCalendar('update', {
          'savePrefs': true,
          'useSavedPrefs': true,
          'language': value
        }, postProcess);
      });

      $(document).on('click', 'div#prefs-window a .toggle:not([disabled])', function(){

        var options = {
          'savePrefs': true,
          'useSavedPrefs': true
        }
        options[$(this).closest('a').attr('id')] = !($(this).data('value'));
        
        $(this).attr('data-value', !($(this).data('value')));

        $(this).animate({'color': 'inherit'}, 300, function(){
          preProcess();
          $('#calendar').ethiopianCalendar('update', options, postProcess);
        });

      });

    });

    function preProcess(){
      $('#calendar-controls').prependTo('body');
      $('#calendar-preferences').appendTo('body');
    }

    function postProcess(){
      var settings = JSON.parse(localStorage.getItem('calendar-prefs'));

      // Localization
      $('html').attr('lang', settings['locale']);
      
      $('*[data-i18n]').i18n();

      $('*[data-i18n-label]').each(function(){
        $(this).attr('aria-label', $.i18n($(this).attr('data-i18n-label')));
        $(this).attr('title', $.i18n($(this).attr('data-i18n-label')));
      });

      // Application controls
      $("div[class^='calendar-']").addClass('tile');
      $("div.calendar-head, div.calendar-body").addClass('is-vertical');

      $("div.calendar-title-cell").addClass('is-parent is-3');
      $("div.calendar-title-cell-inner").addClass('is-child has-text-centered');

      $("div[class^='calendar-dow-cell']").addClass('is-parent is-1');
      $("div.calendar-dow-cell-inner").addClass('is-child has-text-centered').removeClass('is-parent is-1');
      
      $("div[class^='calendar-cell']").addClass('is-parent is-1');
      $("div.calendar-cell-inner").addClass('is-child').removeClass('is-parent is-1');

      $('#calendar-controls').prependTo('.calendar-title-row');
      $('#calendar-preferences').appendTo('.calendar-title-row');

      $('#prefs-window .menu .menu-list li ul a').append(
        $('<span class="octicon octicon-check is-pulled-right" />')
      );

      $('.toggle-control').append(
        $('<span class="toggle is-pulled-right" />').attr('data-value', "false")
      );

      // Prefill forms
      $('div#language-picker a.panel-block').removeClass('is-active');
      $('div#language-picker a.panel-block[data-value="'+settings['locale']+'"]').addClass('is-active');

      $('div#prefs-window li a[data-value]').removeClass('is-active');
      $('div#prefs-window ul#startDay a[data-value="'+settings['startDay']+'"]').addClass('is-active');
      $('div#prefs-window ul#calendarLanguage a[data-value="'+settings['language']+'"]').addClass('is-active');

      var toggles = ['gregorianDates', 'localeDays', 'useLetters', 'useNumbers'];
      $.each(toggles, function(index, value){
        if(settings[value]) $('#'+value+' .toggle').attr('data-value', "true");
        else $('#'+value+' .toggle').attr('data-value', "false");
      });

      // Special form changes for locales

      if(settings['language'] == 'oro'){
        $('#useLetters .toggle').attr('data-value', "false").attr('disabled', '');
        $('#useNumbers .toggle').attr('data-value', "false").attr('disabled', '');
        if(settings['locale'] == 'om') $('#localeDays .toggle').attr('data-value', "true").attr('disabled', '');
      }
      else if(settings['locale'] == 'am'){
        $('#useLetters .toggle').attr('data-value', "true").attr('disabled', '');
        if(settings['language'] == 'amh') $('#localeDays .toggle').attr('data-value', "true").attr('disabled', '');
      }
      else if(settings['locale'] == 'ti'){
        $('#useLetters .toggle').attr('data-value', "true").attr('disabled', '');
        if(settings['language'] == 'tig') $('#localeDays .toggle').attr('data-value', "true").attr('disabled', '');
      }
      else{
        $('#localeDays .toggle').removeAttr('disabled');
        $('#useLetters .toggle').removeAttr('disabled');
        $('#useNumbers .toggle').removeAttr('disabled');
      }
    }
  </script>
</body>
</html>