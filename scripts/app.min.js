/*!
 * jQuery Ethiopic Calendar App
 * By Augustine Dickinson
 *
 * Copyright (c) 2020 Ethiopicist.com and its contributors.
 *
 * @licence MIT License
 */
var today={};function initCallback(){for($("div[class^='calendar-']").addClass("tile"),$("div.calendar-head, div.calendar-body").addClass("is-vertical"),$("div.calendar-title-cell").addClass("is-parent is-3"),$("div.calendar-title-cell-inner").addClass("is-child has-text-centered"),$("div[class^='calendar-dow-cell']").addClass("is-parent is-1"),$("div.calendar-dow-cell-inner").addClass("is-child has-text-centered").removeClass("is-parent is-1"),$("div[class^='calendar-cell']").addClass("is-parent is-1"),$("div.calendar-cell-inner").addClass("is-child").removeClass("is-parent is-1"),$("#calendar-controls").prependTo(".calendar-title-row"),$("#go-to-prev-mobile-control").prependTo(".calendar-title-row"),$("#calendar-preferences").appendTo(".calendar-title-row"),$("#go-to-next-mobile-control").appendTo(".calendar-title-row"),i=1;i<=13;i++)$("select#go-to-month").append($('<option value="'+i+'" data-i18n="ethMonth'+i+'long">')),$("select#convert-ethiopic-month").append($('<option value="'+i+'" data-i18n="ethMonth'+i+'long">')),i<13&&($("select#convert-western-month").append($('<option value="'+i+'" data-i18n="greMonth'+i+'long">')),$("select#convert-islamic-month").append($('<option value="'+i+'" data-i18n="islMonth'+i+'long">')));var e=today;userPreferences("useAmataAlam")&&(e.year+=5500),convertDate(e,"ethiopic",userPreferences("useAmataAlam")),$("#locale-picker .panel-block").append($('<span class="octicon octicon-check is-pulled-right" />')),$("#userPreferences-window .menu .menu-list li ul a").append($('<span class="octicon octicon-check is-pulled-right" />')),$(".toggle-control").each((function(){$(this).append($('<span class="toggle is-pulled-right" />'))})),localize(),fillForms(),userPreferences("useDarkTheme")?$("body").addClass("dark-theme"):$("body").removeClass("dark-theme"),$("body").show()}function updateCallback(){userPreferences("useDarkTheme")?$("body").addClass("dark-theme"):$("body").removeClass("dark-theme"),localize(),fillForms()}function localize(){localizeConversion(),$("html").attr("lang",options("locale")),$("*[data-i18n]").i18n(),$("*[data-i18n-label]").each((function(){$(this).attr("aria-label",$.i18n($(this).attr("data-i18n-label"))),$(this).attr("title",$.i18n($(this).attr("data-i18n-label")))})),"om"==userPreferences("language")?$.i18n().locale="om":"am-eth"==options("locale")||"ti-eth"==options("locale")?$.i18n().locale=options("locale"):$.i18n().locale=userPreferences("language")+(userPreferences("useScript")?"-eth":"-lat"),$("select#go-to-month option").i18n(),$("select#convert-ethiopic-month").i18n()}function fillForms(){$("select#go-to-month option").removeAttr("selected"),$('select#go-to-month option[value="'+options("month").month+'"]').attr("selected",""),$("input#go-to-year").val(userPreferences("useAmataAlam")?options("month").year+5500:options("month").year),$("div#locale-picker a.panel-block").removeClass("is-active"),$('div#locale-picker a.panel-block[data-value="'+options("locale")+'"]').addClass("is-active"),$("div#userPreferences-window li a[data-value]").removeClass("is-active"),$('div#userPreferences-window ul#firstWeekday a[data-value="'+userPreferences("firstWeekday")+'"]').addClass("is-active"),$('div#userPreferences-window ul#alternateCalendar a[data-value="'+userPreferences("alternateCalendar")+'"]').addClass("is-active"),$('div#userPreferences-window ul#language a[data-value="'+userPreferences("language")+'"]').addClass("is-active"),$(".toggle-control").each((function(){$(this).children(".toggle").removeAttr("data-is-true").removeAttr("disabled"),userPreferences($(this).attr("id"))&&$(this).children(".toggle").attr("data-is-true","")})),"om"==userPreferences("language")?($("#useScript .toggle").removeAttr("data-is-true").attr("disabled",""),$("#useNumerals .toggle").removeAttr("data-is-true").attr("disabled",""),"om"==options("locale")&&$("#localeDayNames .toggle").attr("data-is-true","").attr("disabled","")):"am-eth"==options("locale")?($("#useScript .toggle").attr("data-is-true","").attr("disabled",""),"am"==userPreferences("language")&&$("#localeDayNames .toggle").attr("data-is-true","").attr("disabled","")):"ti-eth"==options("locale")&&($("#useScript .toggle").attr("data-is-true","").attr("disabled",""),"ti"==userPreferences("language")&&$("#localeDayNames .toggle").attr("data-is-true","").attr("disabled",""))}function convertDate(e,t,a){if("ethiopic"==t?jdn=ethiopicToJdn(e,a):"western"==t?jdn=westernToJdn(e):"islamic"==t&&(jdn=islamicToJdn(e)),!1===jdn)return alert("The date entered was invalid."),!1;var o=jdnToEthiopic(jdn,a);$("input#convert-ethiopic-year").val(o.year),$("select#convert-ethiopic-month").val(o.month),$("input#convert-ethiopic-date").val(o.date),$("#converted-dates #converted-ethiopic-date").attr("data-year",o.year).attr("data-month",o.month).attr("data-date",o.date).attr("data-day",o.day),a?$("#converted-dates #converted-ethiopic-date").attr("data-is-aa",""):$("#converted-dates #converted-ethiopic-date").removeAttr("data-is-aa");var n=jdnToWestern(jdn);$("input#convert-western-year").val(n.year),$("select#convert-western-month").val(n.month),$("input#convert-western-date").val(n.date),$("#converted-dates #converted-western-date").attr("data-year",n.year).attr("data-month",n.month).attr("data-date",n.date).attr("data-day",n.day);var r=jdnToIslamic(jdn);r?($("input#convert-islamic-year").val(r.year),$("select#convert-islamic-month").val(r.month),$("input#convert-islamic-date").val(r.date),$("#converted-dates #converted-islamic-date").attr("data-year",r.year).attr("data-month",r.month).attr("data-date",r.date).attr("data-day",r.day)):($("input#convert-islamic-year").val(1),$("select#convert-islamic-month").val(1),$("input#convert-islamic-date").val(1),$("#converted-dates #converted-islamic-date").attr("data-year",0).attr("data-month",0).attr("data-date",0).attr("data-day",0)),localizeConversion()}function localizeConversion(){"om"==userPreferences("language")?$.i18n().locale="om":"am-eth"==options("locale")||"ti-eth"==options("locale")?$.i18n().locale=options("locale"):$.i18n().locale=userPreferences("language")+(userPreferences("useScript")?"-eth":"-lat");var e=$("#converted-dates #converted-ethiopic-date");if(e.is("[data-is-aa]")!=userPreferences("useAmataAlam"))if(userPreferences("useAmataAlam")){var t=parseInt(e.attr("data-year"))+5500;e.attr("data-is-aa",""),e.attr("data-year",t),$("input#convert-ethiopic-year").val(t)}else{var t=parseInt(e.attr("data-year"))-5500;e.removeAttr("data-is-aa"),e.attr("data-year",t),$("input#convert-ethiopic-year").val(t)}e.text($.i18n("{{datestring:eth|$1|$2|$3|$4}}",toEthiopicNumeral(parseInt(e.attr("data-year")),userPreferences("useNumerals")&&"om"!=$.i18n().locale),parseInt(e.attr("data-month")),toEthiopicNumeral(parseInt(e.attr("data-date")),userPreferences("useNumerals")&&"om"!=$.i18n().locale,"gez"==userPreferences("language")),parseInt(e.attr("data-day")))),$.i18n().locale=options("locale");var a=$("#converted-dates #converted-western-date");a.text($.i18n("{{datestring:wes|$1|$2|$3|$4}}",parseInt(a.attr("data-year")),parseInt(a.attr("data-month")),parseInt(a.attr("data-date")),parseInt(a.attr("data-day"))));var o=$("#converted-dates #converted-islamic-date");parseInt(o.attr("data-year"))>0?o.text($.i18n("{{datestring:isl|$1|$2|$3|$4}}",parseInt(o.attr("data-year")),parseInt(o.attr("data-month")),parseInt(o.attr("data-date")),parseInt(o.attr("data-day")))):o.text("")}function options(e,t){const a={month:{year:today.year,month:today.month},locale:"en"};if(void 0===t){var o={};return void 0!==e&&"month"!=e||(null===localStorage.getItem("month")&&localStorage.setItem("month",JSON.stringify(a.month)),o.month=JSON.parse(localStorage.getItem("month")),"month"in o.month?o.month.month<1?o.month.month=1:o.month.month>13&&(o.month.month=13):o.month.month=today.month,"year"in o.month?o.month.year<1&&(o.month.year=1):o.month.year=today.year),void 0!==e&&"locale"!=e||(null===localStorage.getItem("locale")&&localStorage.setItem("locale",a.locale),o.locale=localStorage.getItem("locale")),o.userPreferences=userPreferences(),"month"==e?o.month:"locale"==e?o.locale:"userPreferences"==e?o.userPreferences:o}void 0!==e&&void 0!==t&&("string"==typeof t?localStorage.setItem(e,t):"object"==typeof t&&localStorage.setItem(e,JSON.stringify(t)))}function userPreferences(e,t){const a={firstWeekday:2,useAmataAlam:!1,showAlternateDates:!0,alternateCalendar:"gre",language:"gez",localeDayNames:!0,useDarkTheme:!1,useScript:!0,useNumerals:!0,showEvangelists:!1};var o={};if(null===localStorage.getItem("userPreferences"))localStorage.setItem("userPreferences",JSON.stringify(a)),o=a;else{o=JSON.parse(localStorage.getItem("userPreferences"));var n=!1;for(const e in o)e in o||(o[e]=a[e],n=!0);n&&localStorage.setItem("userPreferences",JSON.stringify(o))}return void 0===e?o:void 0===t?o[e]:(o[e]=t,void localStorage.setItem("userPreferences",JSON.stringify(o)))}today.year=(new Date).getFullYear(),today.month=(new Date).getMonth()+1,today.date=(new Date).getDate(),today=toEthiopic(today),$(document).ready((function(){$("#calendar").ethiopianCalendar(options(),initCallback),$(document).on("click",'div[id^="go-to-buttons"] a[id^="go-to-"]',(function(){$(this).attr("id").startsWith("go-to-prev")?1==options("month").month&&options("month").year>1?options("month",{year:options("month").year-1,month:13}):options("month").month>1&&options("month",{year:options("month").year,month:options("month").month-1}):$(this).attr("id").startsWith("go-to-today")?options("month",{year:today.year,month:today.month}):$(this).attr("id").startsWith("go-to-next")&&(13==options("month").month?options("month",{year:options("month").year+1,month:1}):options("month",{year:options("month").year,month:options("month").month+1})),$("#calendar").ethiopianCalendar("update",options(),updateCallback)})),$(document).on("click","div#go-to-field a#go-to-submit",(function(){var e={};e.month=parseInt($("select#go-to-month").val()),e.year=parseInt($("input#go-to-year").val()),userPreferences("useAmataAlam")&&(e.year-=5500),options("month",{year:e.year,month:e.month}),$("div#go-to-field").hide(),$("div#go-to-buttons").show(),$("#calendar").ethiopianCalendar("update",options(),updateCallback)})),$(document).on("click","div#go-to-buttons a#go-to-field-button",(function(){$("div#go-to-buttons").hide(),$("div#go-to-field").show()})),$(document).on("click","div#go-to-field a#go-to-cancel",(function(){$("div#go-to-field").hide(),$("div#go-to-buttons").show()})),$(document).on("click",'a[id^="open-locale-picker"]',(function(){$("div#locale-picker").addClass("is-active"),$("html").addClass("is-clipped")})),$(document).on("click","div#locale-picker div.modal-background, div#locale-picker button",(function(){$("div#locale-picker").removeClass("is-active"),$("html").removeClass("is-clipped")})),$(document).on("click","div#locale-picker a.panel-block",(function(){$("div#locale-picker").removeClass("is-active"),$("html").removeClass("is-clipped"),options("locale",$(this).data("value")),$("#calendar").ethiopianCalendar("update",options(),updateCallback)})),$(document).on("click",'a[id^="open-userPreferences"]',(function(){$("div#userPreferences-window").addClass("is-active"),$("html").addClass("is-clipped")})),$(document).on("click","div#userPreferences-window div.modal-background, div#userPreferences-window button",(function(){$("div#userPreferences-window").removeClass("is-active"),$("html").removeClass("is-clipped")})),$(document).on("click","div#userPreferences-window .menu-list li ul a",(function(){userPreferences($(this).parents("ul").attr("id"),$(this).data("value")),$("#calendar").ethiopianCalendar("update",options(),updateCallback)})),$(document).on("click","div#userPreferences-window a .toggle:not([disabled])",(function(){userPreferences($(this).parents("a").attr("id"),!$(this).is("[data-is-true]")),$(this).is("[data-is-true]")?$(this).removeAttr("data-is-true"):$(this).attr("data-is-true",""),$("#calendar").ethiopianCalendar("update",options(),updateCallback)})),$(document).on("click",'a[id^="open-converter"]',(function(){$("div#converter-window").addClass("is-active"),$("html").addClass("is-clipped")})),$(document).on("click","div#converter-window div.modal-background, div#converter-window button",(function(){$("div#converter-window").removeClass("is-active"),$("html").removeClass("is-clipped")})),$(document).on("click",'div#converter-window li[id^="convert-"] a',(function(){$("div#converter-window li").removeClass("is-active"),$(this).parent().addClass("is-active"),$("div#converter-window form").hide(),$("div#converter-window form#"+$(this).parent().attr("id")+"-form").show()})),$(document).on("click",'div#converter-window a[id^="convert-"][id$="-submit"]',(function(){var e=$(this).attr("id").slice(0,-7).substr(8);const t={year:parseInt($("#convert-"+e+"-year").val()),month:parseInt($("#convert-"+e+"-month").val()),date:parseInt($("#convert-"+e+"-date").val())};convertDate(t,e,userPreferences("useAmataAlam"))})),$(document).keydown((function(e){switch(e.which){case 37:case 38:$("a#go-to-prev").trigger("click");break;case 39:case 40:$("a#go-to-next").trigger("click");break;case 84:$("a#go-to-today").trigger("click");break;default:return}e.preventDefault()}))}));