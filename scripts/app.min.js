/*!
 * jQuery Ethiopic Calendar App
 * By Augustine Dickinson
 *
 * Copyright (c) 2020 Ethiopicist.com and its contributors.
 *
 * @licence MIT License
 */
"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js");var today={};function initCallback(){for($("div[class^='calendar-']").addClass("tile"),$("div.calendar-head, div.calendar-body").addClass("is-vertical"),$("div.calendar-title-cell").addClass("is-parent is-3"),$("div.calendar-title-cell-inner").addClass("is-child has-text-centered"),$("div[class^='calendar-dow-cell']").addClass("is-parent is-1"),$("div.calendar-dow-cell-inner").addClass("is-child has-text-centered").removeClass("is-parent is-1"),$("div[class^='calendar-cell']").addClass("is-parent is-1"),$("div.calendar-cell-inner").addClass("is-child").removeClass("is-parent is-1"),$("#calendar-controls").prependTo(".calendar-title-row"),$("#go-to-prev-mobile-control").prependTo(".calendar-title-row"),$("#calendar-preferences").appendTo(".calendar-title-row"),$("#go-to-next-mobile-control").appendTo(".calendar-title-row"),i=1;i<=13;i++)$("select#go-to-month").append($('<option value="'+i+'" data-i18n="ethMonth'+i+'long">')),$("select#convert-ethiopic-month").append($('<option value="'+i+'" data-i18n="ethMonth'+i+'long">')),i<13&&($("select#convert-western-month").append($('<option value="'+i+'" data-i18n="greMonth'+i+'long">')),$("select#convert-islamic-month").append($('<option value="'+i+'" data-i18n="islMonth'+i+'long">')));var e=today;userPreferences("useAmataAlam")&&(e.year+=5500),convertDate(e,"ethiopic",userPreferences("useAmataAlam")),$("#locale-picker .panel-block").append($('<span class="octicon octicon-check is-pulled-right" />')),$("#userPreferences-window .menu .menu-list li ul a").append($('<span class="octicon octicon-check is-pulled-right" />')),$(".toggle-control").each((function(){$(this).append($('<span class="toggle is-pulled-right" />'))})),$("#computus-table").seaOfComputation("init",options("month").year,options()),options("month").year<353?($('a[id^="open-computus"]').hide(),$("div#computus-window").removeClass("is-active"),$("html").removeClass("is-clipped")):$('a[id^="open-computus"]').show(),localize(),fillForms(),userPreferences("useDarkTheme")?$("body").addClass("dark-theme"):$("body").removeClass("dark-theme"),$("body").show()}function updateCallback(){userPreferences("useDarkTheme")?$("body").addClass("dark-theme"):$("body").removeClass("dark-theme"),$(".is-highlighted").removeClass("is-highlighted"),$("#computus-table tbody").html(""),$("#computus-table").seaOfComputation("init",options("month").year,options()),options("month").year<353?($('a[id^="open-computus"]').hide(),$("div#computus-window").removeClass("is-active"),$("html").removeClass("is-clipped")):$('a[id^="open-computus"]').show(),localize(),fillForms()}function localize(){$.i18n().locale=options("locale"),$("html").attr("lang",options("locale")),$("*[data-i18n]").i18n(),$("*[data-i18n-label]").each((function(){$(this).attr("aria-label",$.i18n($(this).attr("data-i18n-label"))),$(this).attr("title",$.i18n($(this).attr("data-i18n-label")))})),$("#converted-western-date, #converted-islamic-date").children().each((function(){if("converted-western-date"==$(this).parent().attr("id"))var e="gre";else if("converted-islamic-date"==$(this).parent().attr("id"))var e="isl";"converted-day"==$(this).attr("class")?void 0!==$(this).attr("data-day")&&$(this).text($.i18n("day"+$(this).attr("data-day")+"long")):"converted-date"==$(this).attr("class")?void 0!==$(this).attr("data-date")&&$(this).text($(this).attr("data-date")):"converted-month"==$(this).attr("class")?void 0!==$(this).attr("data-month")&&$(this).text($.i18n(e+"Month"+$(this).attr("data-month")+"long"+("pl"==$.i18n().locale?"-gen":""))):"converted-year"==$(this).attr("class")&&void 0!==$(this).attr("data-year")&&$(this).text($(this).attr("data-year"))})),"om"==userPreferences("language")?$.i18n().locale="om":"am-eth"==options("locale")||"ti-eth"==options("locale")?$.i18n().locale=userPreferences("language")+"-eth":$.i18n().locale=userPreferences("language")+(userPreferences("useScript")?"-eth":"-lat"),$("select#go-to-month option").i18n(),$("select#convert-ethiopic-month").i18n(),$("#converted-ethiopic-date .converted-day").text(("gez-eth"==$.i18n().locale?"ዕለተ፡ ":"")+$.i18n("day"+$("#converted-ethiopic-date .converted-day").attr("data-day")+"long")),$("#converted-ethiopic-date .converted-date").text(toEthiopicNumeral(parseInt($("#converted-ethiopic-date .converted-date").attr("data-date")),userPreferences("useNumerals"))),$("#converted-ethiopic-date .converted-month").text(("gez-eth"==$.i18n().locale?"ለ":"")+$.i18n("ethMonth"+$("#converted-ethiopic-date .converted-month").attr("data-month")+"long")),$("#converted-ethiopic-date .converted-year").text(toEthiopicNumeral(parseInt($("#converted-ethiopic-date .converted-year").attr("data-year")),userPreferences("useNumerals")))}function fillForms(){$("select#go-to-month option").removeAttr("selected"),$('select#go-to-month option[value="'+options("month").month+'"]').attr("selected",""),$("input#go-to-year").val(userPreferences("useAmataAlam")?options("month").year+5500:options("month").year),$("div#locale-picker a.panel-block").removeClass("is-active"),$('div#locale-picker a.panel-block[data-value="'+options("locale")+'"]').addClass("is-active"),$("div#userPreferences-window li a[data-value]").removeClass("is-active"),$('div#userPreferences-window ul#firstWeekday a[data-value="'+userPreferences("firstWeekday")+'"]').addClass("is-active"),$('div#userPreferences-window ul#alternateCalendar a[data-value="'+userPreferences("alternateCalendar")+'"]').addClass("is-active"),$('div#userPreferences-window ul#language a[data-value="'+userPreferences("language")+'"]').addClass("is-active"),$(".toggle-control").each((function(){$(this).children(".toggle").removeAttr("data-is-true").removeAttr("disabled"),userPreferences($(this).attr("id"))&&$(this).children(".toggle").attr("data-is-true","")})),"om"==userPreferences("language")?($("#useScript .toggle").removeAttr("data-is-true").attr("disabled",""),$("#useNumerals .toggle").removeAttr("data-is-true").attr("disabled",""),"om"==options("locale")&&$("#localeDayNames .toggle").attr("data-is-true","").attr("disabled","")):"am-eth"==options("locale")?($("#useScript .toggle").attr("data-is-true","").attr("disabled",""),"am"==userPreferences("language")&&$("#localeDayNames .toggle").attr("data-is-true","").attr("disabled","")):"ti-eth"==options("locale")&&($("#useScript .toggle").attr("data-is-true","").attr("disabled",""),"ti"==userPreferences("language")&&$("#localeDayNames .toggle").attr("data-is-true","").attr("disabled",""))}function convertDate(e,t,a){if("ethiopic"==t?jdn=ethiopicToJdn(e,a):"western"==t?jdn=westernToJdn(e):"islamic"==t&&(jdn=islamicToJdn(e)),!1===jdn)return alert("The date entered was invalid."),!1;var o=jdnToEthiopic(jdn,a);$("#converted-ethiopic-date .converted-day").attr("data-day",o.day),$("#converted-ethiopic-date .converted-date").attr("data-date",o.date),$("input#convert-ethiopic-date").val(o.date),$("#converted-ethiopic-date .converted-month").attr("data-month",o.month),$("select#convert-ethiopic-month").val(o.month),$("#converted-ethiopic-date .converted-year").attr("data-year",o.year),$("input#convert-ethiopic-year").val(o.year);var n=jdnToWestern(jdn);$("#converted-western-date .converted-day").attr("data-day",n.day),$("#converted-western-date .converted-date").attr("data-date",n.date),$("input#convert-western-date").val(n.date),$("#converted-western-date .converted-month").attr("data-month",n.month),$("select#convert-western-month").val(n.month),$("#converted-western-date .converted-year").attr("data-year",n.year),$("input#convert-western-year").val(n.year);var i=jdnToIslamic(jdn);i?($("#converted-islamic-date .converted-day").attr("data-day",i.day),$("#converted-islamic-date .converted-date").attr("data-date",i.date),$("input#convert-islamic-date").val(i.date),$("#converted-islamic-date .converted-month").attr("data-month",i.month),$("select#convert-islamic-month").val(i.month),$("#converted-islamic-date .converted-year").attr("data-year",i.year),$("input#convert-islamic-year").val(i.year)):($("input#convert-islamic-year").val(1),$("select#convert-islamic-month").val(1),$("input#convert-islamic-date").val(1),$("#converted-islamic-date span").removeAttr("data-day data-date data-month data-year").text("")),localize()}function options(e,t){const a={month:{year:today.year,month:today.month},locale:"en"};if(void 0===t){var o={};return void 0!==e&&"month"!=e||(null===localStorage.getItem("month")&&localStorage.setItem("month",JSON.stringify(a.month)),o.month=JSON.parse(localStorage.getItem("month")),"month"in o.month?o.month.month<1?o.month.month=1:o.month.month>13&&(o.month.month=13):o.month.month=today.month,"year"in o.month?o.month.year<1&&(o.month.year=1):o.month.year=today.year),void 0!==e&&"locale"!=e||(null===localStorage.getItem("locale")&&localStorage.setItem("locale",a.locale),o.locale=localStorage.getItem("locale")),o.userPreferences=userPreferences(),"month"==e?o.month:"locale"==e?o.locale:"userPreferences"==e?o.userPreferences:o}void 0!==e&&void 0!==t&&("string"==typeof t?localStorage.setItem(e,t):"object"==typeof t&&localStorage.setItem(e,JSON.stringify(t)))}function userPreferences(e,t){const a={firstWeekday:2,useAmataAlam:!1,showAlternateDates:!0,alternateCalendar:"gre",language:"gez",localeDayNames:!0,useDarkTheme:!1,useScript:!0,useNumerals:!0};var o={};if(null===localStorage.getItem("userPreferences"))localStorage.setItem("userPreferences",JSON.stringify(a)),o=a;else{o=JSON.parse(localStorage.getItem("userPreferences"));var n=!1;for(const e in o)e in o||(o[e]=a[e],n=!0);n&&localStorage.setItem("userPreferences",JSON.stringify(o))}return void 0===e?o:void 0===t?o[e]:(o[e]=t,void localStorage.setItem("userPreferences",JSON.stringify(o)))}today.year=(new Date).getFullYear(),today.month=(new Date).getMonth()+1,today.date=(new Date).getDate(),today=toEthiopic(today),$(document).ready((function(){$("#calendar").ethiopianCalendar(options(),initCallback),$(document).on("click touchend",'div[id^="go-to-buttons"] a[id^="go-to-"]',(function(e){e.preventDefault(),$(this).attr("id").startsWith("go-to-prev")?1==options("month").month&&options("month").year>1?options("month",{year:options("month").year-1,month:13}):options("month").month>1&&options("month",{year:options("month").year,month:options("month").month-1}):$(this).attr("id").startsWith("go-to-today")?options("month",{year:today.year,month:today.month}):$(this).attr("id").startsWith("go-to-next")&&(13==options("month").month?options("month",{year:options("month").year+1,month:1}):options("month",{year:options("month").year,month:options("month").month+1})),$("#calendar").ethiopianCalendar("update",options(),updateCallback)})),$(document).on("click","div#go-to-field a#go-to-submit",(function(){var e={};e.month=parseInt($("select#go-to-month").val()),e.year=parseInt($("input#go-to-year").val()),userPreferences("useAmataAlam")&&(e.year-=5500),options("month",{year:e.year,month:e.month}),$("div#go-to-field").hide(),$("div#go-to-buttons").show(),$("#calendar").ethiopianCalendar("update",options(),updateCallback)})),$(document).on("click","div#go-to-buttons a#go-to-field-button",(function(){$("div#go-to-buttons").hide(),$("div#go-to-field").show()})),$(document).on("click","div#go-to-field a#go-to-cancel",(function(){$("div#go-to-field").hide(),$("div#go-to-buttons").show()})),$(document).on("click",'a[id^="open-locale-picker"]',(function(){$("div#locale-picker").addClass("is-active"),$("html").addClass("is-clipped")})),$(document).on("click","div#locale-picker div.modal-background, div#locale-picker button",(function(){$("div#locale-picker").removeClass("is-active"),$("html").removeClass("is-clipped")})),$(document).on("click","div#locale-picker a.panel-block",(function(){$("div#locale-picker").removeClass("is-active"),$("html").removeClass("is-clipped"),options("locale",$(this).data("value")),$("#calendar").ethiopianCalendar("update",options(),updateCallback)})),$(document).on("click",'a[id^="open-userPreferences"]',(function(){$("div#userPreferences-window").addClass("is-active"),$("html").addClass("is-clipped")})),$(document).on("click","div#userPreferences-window div.modal-background, div#userPreferences-window button",(function(){$("div#userPreferences-window").removeClass("is-active"),$("html").removeClass("is-clipped")})),$(document).on("click","div#userPreferences-window .menu-list li ul a",(function(){userPreferences($(this).parents("ul").attr("id"),$(this).data("value")),$("#calendar").ethiopianCalendar("update",options(),updateCallback)})),$(document).on("click","div#userPreferences-window a .toggle:not([disabled])",(function(){userPreferences($(this).parents("a").attr("id"),!$(this).is("[data-is-true]")),$(this).is("[data-is-true]")?$(this).removeAttr("data-is-true"):$(this).attr("data-is-true",""),$("#calendar").ethiopianCalendar("update",options(),updateCallback)})),$(document).on("click",'a[id^="open-converter"]',(function(){$("div#converter-window").addClass("is-active"),$("html").addClass("is-clipped")})),$(document).on("click","div#converter-window div.modal-background, div#converter-window button",(function(){$("div#converter-window").removeClass("is-active"),$("html").removeClass("is-clipped")})),$(document).on("click",'div#converter-window li[id^="convert-"] a',(function(){$("div#converter-window li").removeClass("is-active"),$(this).parent().addClass("is-active"),$("div#converter-window form").hide(),$("div#converter-window form#"+$(this).parent().attr("id")+"-form").show()})),$(document).on("click",'div#converter-window a[id^="convert-"][id*="-submit"]',(function(){if($(this).attr("id").includes("ethiopic"))var e="ethiopic";else if($(this).attr("id").includes("western"))var e="western";else if($(this).attr("id").includes("islamic"))var e="islamic";const t={year:parseInt($("#convert-"+e+"-year").val()),month:parseInt($("#convert-"+e+"-month").val()),date:parseInt($("#convert-"+e+"-date").val())};convertDate(t,e,userPreferences("useAmataAlam"))})),$(document).on("click",'a[id^="open-computus"]',(function(){$("div#computus-window").addClass("is-active"),$("html").addClass("is-clipped")})),$(document).on("click","div#computus-window div.modal-background, div#computus-window button",(function(){$("div#computus-window").removeClass("is-active"),$("html").removeClass("is-clipped")})),$(document).on("click","table#computus-table tbody td",(function(){void 0!==$(this).attr("data-year")&&void 0!==$(this).attr("data-month")&&($("div#computus-window").removeClass("is-active"),$("html").removeClass("is-clipped"),options("month",{year:parseInt($(this).attr("data-year")),month:parseInt($(this).attr("data-month"))}),$("#calendar").ethiopianCalendar("update",options(),updateCallback),$('div[class^="calendar-cell"][data-ethiopic-year="'+$(this).attr("data-year")+'"][data-ethiopic-month="'+$(this).attr("data-month")+'"][data-ethiopic-date="'+$(this).attr("data-date")+'"]').addClass("is-highlighted"))})),$(document).keydown((function(e){if($("input:focus").length<1){switch(e.which){case 37:case 38:$("a#go-to-prev").trigger("click");break;case 39:case 40:$("a#go-to-next").trigger("click");break;case 84:$("a#go-to-today").trigger("click");break;default:return}e.preventDefault()}}))}));